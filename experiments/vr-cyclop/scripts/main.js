THREE.TrackballControls=function(a,b){function c(a){l.enabled!==!1&&(window.removeEventListener("keydown",c),q=p,p===m.NONE&&(a.keyCode!==l.keys[m.ROTATE]||l.noRotate?a.keyCode!==l.keys[m.ZOOM]||l.noZoom?a.keyCode!==l.keys[m.PAN]||l.noPan||(p=m.PAN):p=m.ZOOM:p=m.ROTATE))}function d(){l.enabled!==!1&&(p=q,window.addEventListener("keydown",c,!1))}function e(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),p===m.NONE&&(p=a.button),p!==m.ROTATE||l.noRotate?p!==m.ZOOM||l.noZoom?p!==m.PAN||l.noPan||(y.copy(D(a.pageX,a.pageY)),z.copy(y)):(u.copy(D(a.pageX,a.pageY)),v.copy(u)):(s.copy(E(a.pageX,a.pageY)),t.copy(s)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),l.dispatchEvent(B))}function f(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),p!==m.ROTATE||l.noRotate?p!==m.ZOOM||l.noZoom?p!==m.PAN||l.noPan||z.copy(D(a.pageX,a.pageY)):v.copy(D(a.pageX,a.pageY)):t.copy(E(a.pageX,a.pageY)))}function g(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),p=m.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),l.dispatchEvent(C))}function h(a){if(l.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),u.y+=.01*b,l.dispatchEvent(B),l.dispatchEvent(C)}}function i(a){if(l.enabled!==!1){switch(a.touches.length){case 1:p=m.TOUCH_ROTATE,s.copy(E(a.touches[0].pageX,a.touches[0].pageY)),t.copy(s);break;case 2:p=m.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;x=w=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;y.copy(D(d,e)),z.copy(y);break;default:p=m.NONE}l.dispatchEvent(B)}}function j(a){if(l.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:t.copy(E(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;x=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;z.copy(D(d,e));break;default:p=m.NONE}}function k(a){if(l.enabled!==!1){switch(a.touches.length){case 1:t.copy(E(a.touches[0].pageX,a.touches[0].pageY)),s.copy(t);break;case 2:w=x=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,c=(a.touches[0].pageY+a.touches[1].pageY)/2;z.copy(D(b,c)),y.copy(z)}p=m.NONE,l.dispatchEvent(C)}}var l=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var n=1e-6,o=new THREE.Vector3,p=m.NONE,q=m.NONE,r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector2,v=new THREE.Vector2,w=0,x=0,y=new THREE.Vector2,z=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var A={type:"change"},B={type:"start"},C={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var D=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-l.screen.left)/l.screen.width,(c-l.screen.top)/l.screen.height),a}}(),E=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){c.set((d-.5*l.screen.width-l.screen.left)/(.5*l.screen.width),(.5*l.screen.height+l.screen.top-e)/(.5*l.screen.height),0);var f=c.length();return l.noRoll?c.z=f<Math.SQRT1_2?Math.sqrt(1-f*f):.5/f:f>1?c.normalize():c.z=Math.sqrt(1-f*f),r.copy(l.object.position).sub(l.target),a.copy(l.object.up).setLength(c.y),a.add(b.copy(l.object.up).cross(r).setLength(c.x)),a.add(r.setLength(c.z)),a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(s.dot(t)/s.length()/t.length());c&&(a.crossVectors(s,t).normalize(),c*=l.rotateSpeed,b.setFromAxisAngle(a,-c),r.applyQuaternion(b),l.object.up.applyQuaternion(b),t.applyQuaternion(b),l.staticMoving?s.copy(t):(b.setFromAxisAngle(a,c*(l.dynamicDampingFactor-1)),s.applyQuaternion(b)))}}(),this.zoomCamera=function(){if(p===m.TOUCH_ZOOM_PAN){var a=w/x;w=x,r.multiplyScalar(a)}else{var a=1+(v.y-u.y)*l.zoomSpeed;1!==a&&a>0&&(r.multiplyScalar(a),l.staticMoving?u.copy(v):u.y+=(v.y-u.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(z).sub(y),a.lengthSq()&&(a.multiplyScalar(r.length()*l.panSpeed),c.copy(r).cross(l.object.up).setLength(a.x),c.add(b.copy(l.object.up).setLength(a.y)),l.object.position.add(c),l.target.add(c),l.staticMoving?y.copy(z):y.add(a.subVectors(z,y).multiplyScalar(l.dynamicDampingFactor)))}}(),this.checkDistances=function(){l.noZoom&&l.noPan||(r.lengthSq()>l.maxDistance*l.maxDistance&&l.object.position.addVectors(l.target,r.setLength(l.maxDistance)),r.lengthSq()<l.minDistance*l.minDistance&&l.object.position.addVectors(l.target,r.setLength(l.minDistance)))},this.update=function(){r.subVectors(l.object.position,l.target),l.noRotate||l.rotateCamera(),l.noZoom||l.zoomCamera(),l.noPan||l.panCamera(),l.object.position.addVectors(l.target,r),l.checkDistances(),l.object.lookAt(l.target),o.distanceToSquared(l.object.position)>n&&(l.dispatchEvent(A),o.copy(l.object.position))},this.reset=function(){p=m.NONE,q=m.NONE,l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.up.copy(l.up0),r.subVectors(l.object.position,l.target),l.object.lookAt(l.target),l.dispatchEvent(A),o.copy(l.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.PointerLockControls=function(a){var b=this;a.rotation.set(0,0,0);var c=new THREE.Object3D;c.add(a);var d=new THREE.Object3D;d.position.y=10,d.add(c);var e=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=performance.now(),l=new THREE.Vector3,m=Math.PI/2,n=function(a){if(b.enabled!==!1){var e=a.movementX||a.mozMovementX||a.webkitMovementX||0,f=a.movementY||a.mozMovementY||a.webkitMovementY||0;d.rotation.y-=.002*e,c.rotation.x-=.002*f,c.rotation.x=Math.max(-m,Math.min(m,c.rotation.x))}},o=function(a){switch(a.keyCode){case 38:case 87:e=!0;break;case 37:case 65:g=!0;break;case 40:case 83:f=!0;break;case 39:case 68:h=!0;break;case 32:j===!0&&(l.y+=350),j=!1}},p=function(a){switch(a.keyCode){case 38:case 87:e=!1;break;case 37:case 65:g=!1;break;case 40:case 83:f=!1;break;case 39:case 68:h=!1}};document.addEventListener("mousemove",n,!1),document.addEventListener("keydown",o,!1),document.addEventListener("keyup",p,!1),this.enabled=!1,this.getObject=function(){return d},this.isOnObject=function(a){i=a,j=a},this.getDirection=function(){var a=new THREE.Vector3(0,0,-1),b=new THREE.Euler(0,0,0,"YXZ");return function(e){return b.set(c.rotation.x,d.rotation.y,0),e.copy(a).applyEuler(b),e}}(),this.update=function(){if(b.enabled!==!1){var a=performance.now(),c=(a-k)/1e3;l.x-=10*l.x*c,l.z-=10*l.z*c,l.y-=9.8*100*c,e&&(l.z-=400*c),f&&(l.z+=400*c),g&&(l.x-=400*c),h&&(l.x+=400*c),i===!0&&(l.y=Math.max(0,l.y)),d.translateX(l.x*c),d.translateY(l.y*c),d.translateZ(l.z*c),d.position.y<10&&(l.y=0,d.position.y=10,j=!0),k=a}}},THREE.VRControls=function(a,b){this._camera=a,this._init=function(){function a(a){for(var d,e,f=0;f<a.length;++f)if(a[f]instanceof PositionSensorVRDevice){d=a[f],c._vrInput=d;break}b&&(d||(e="HMD not available"),b(e))}var c=this;return navigator.mozGetVRDevices||navigator.getVRDevices?void(navigator.getVRDevices?navigator.getVRDevices().then(a):navigator.mozGetVRDevices(a)):void(b&&b("Your browser is not VR Ready"))},this._init(),this.update=function(){var a=this._camera,b=this.getVRState();b&&a&&a.quaternion.fromArray(b.hmd.rotation)},this.getVRState=function(){var a,b,c=this._vrInput;return c?(a=c.getState().orientation,b={hmd:{rotation:[a.x,a.y,a.z,a.w]}}):null}},THREE.VREffect=function(a,b){this._renderer=a,this._init=function(){function a(a){for(var d,e,f=0;f<a.length;++f)if(a[f]instanceof HMDVRDevice){d=a[f],console.log(d),c._vrHMD=d,c.leftEyeTranslation=d.getEyeTranslation("left"),c.rightEyeTranslation=d.getEyeTranslation("right"),c.leftEyeFOV=d.getRecommendedEyeFieldOfView("left"),c.rightEyeFOV=d.getRecommendedEyeFieldOfView("right");break}b&&(d||(e="HMD not available"),b(e))}var c=this;return navigator.mozGetVRDevices||navigator.getVRDevices?void(navigator.getVRDevices?navigator.getVRDevices().then(a):navigator.mozGetVRDevices(a)):void(b&&b("Your browser is not VR Ready"))},this._init(),this.render=function(){var a=this._renderer,b=this._vrHMD;return a.enableScissorTest(!1),b?void this.renderStereo.apply(this,arguments):void a.render.apply(this._renderer,arguments)},this.renderStereo=function(a,b){var c,d,e=this.leftEyeTranslation,f=this.rightEyeTranslation,g=this._renderer,h=g.domElement.width/g.devicePixelRatio,i=g.domElement.height/g.devicePixelRatio,j=h/2;g.enableScissorTest(!0),g.clear(),b.matrixAutoUpdate&&b.updateMatrix();b.matrixWorld.clone();c=b.clone(),d=b.clone(),c.projectionMatrix=this.FovToProjection(this.leftEyeFOV),d.projectionMatrix=this.FovToProjection(this.rightEyeFOV),c.position.add(new THREE.Vector3(e.x,e.y,e.z)),d.position.add(new THREE.Vector3(f.x,f.y,f.z)),g.setViewport(0,0,j,i),g.setScissor(0,0,j,i),g.render(a,c),g.setViewport(j,0,j,i),g.setScissor(j,0,j,i),g.render(a,d)},this.setFullScreen=function(a){var b=this._renderer,c=this._vrHMD,d=this._canvasOriginalSize;if(c&&a!==this._fullScreen){if(this._fullScreen=!!a,!a)return void b.setSize(d.width,d.height);this._canvasOriginalSize={width:b.domElement.width,height:b.domElement.height},b.setSize(2244,1553,!1),this.startFullscreen()}},this.startFullscreen=function(){function a(){document.mozFullScreenElement||document.webkitFullScreenElement||b.setFullScreen(!1)}var b=this,c=this._renderer,d=this._vrHMD,e=c.domElement,f=e.mozRequestFullScreen?"mozfullscreenchange":"webkitfullscreenchange";document.addEventListener(f,a,!1),e.mozRequestFullScreen?e.mozRequestFullScreen({vrDisplay:d}):e.webkitRequestFullscreen({vrDisplay:d})},this.FovToNDCScaleOffset=function(a){var b=2/(a.leftTan+a.rightTan),c=(a.leftTan-a.rightTan)*b*.5,d=2/(a.upTan+a.downTan),e=(a.upTan-a.downTan)*d*.5;return{scale:[b,d],offset:[c,e]}},this.FovPortToProjection=function(a,b,c,d){b=void 0===b?!0:b,c=void 0===c?.01:c,d=void 0===d?1e4:d;var e=b?-1:1,f=new THREE.Matrix4,g=f.elements,h=this.FovToNDCScaleOffset(a);return g[0]=h.scale[0],g[1]=0,g[2]=h.offset[0]*e,g[3]=0,g[4]=0,g[5]=h.scale[1],g[6]=-h.offset[1]*e,g[7]=0,g[8]=0,g[9]=0,g[10]=d/(c-d)*-e,g[11]=d*c/(c-d),g[12]=0,g[13]=0,g[14]=e,g[15]=0,f.transpose(),f},this.FovToProjection=function(a,b,c,d){var e={upTan:Math.tan(a.upDegrees*Math.PI/180),downTan:Math.tan(a.downDegrees*Math.PI/180),leftTan:Math.tan(a.leftDegrees*Math.PI/180),rightTan:Math.tan(a.rightDegrees*Math.PI/180)};return this.FovPortToProjection(e,b,c,d)}},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(a,b){var c=this,d=new THREE.XHRLoader(c.manager);d.setCrossOrigin(this.crossOrigin),d.load(a,function(d){c.parse(JSON.parse(d),b,a)})},setCrossOrigin:function(a){this.crossOrigin=a},addGeometryHandler:function(a,b){this.geometryHandlers[a]={loaderClass:b}},addHierarchyHandler:function(a,b){this.hierarchyHandlers[a]={loaderClass:b}},parse:function(a,b,c){function d(a,b){return"relativeToHTML"==b?a:B+a}function e(){f(z.scene,D.objects)}function f(a,b){var c,e,g,h,i;for(var k in b){var l=z.objects[k],m=b[k];if(void 0===l){if(m.type&&m.type in A.hierarchyHandlers){if(void 0===m.loading){var n={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},r={};for(var s in m)s in n||(r[s]=m[s]);p=z.materials[m.material],m.loading=!0;var t=A.hierarchyHandlers[m.type].loaderObject;t.options?t.load(d(m.url,D.urlBaseType),j(k,a,p,m)):t.load(d(m.url,D.urlBaseType),j(k,a,p,m),r)}}else if(void 0!==m.geometry){if(o=z.geometries[m.geometry]){var v=!1;if(p=z.materials[m.material],v=p instanceof THREE.ShaderMaterial,e=m.position,g=m.rotation,h=m.scale,c=m.matrix,i=m.quaternion,m.material||(p=new THREE.MeshFaceMaterial(z.face_materials[m.geometry])),p instanceof THREE.MeshFaceMaterial&&0===p.materials.length&&(p=new THREE.MeshFaceMaterial(z.face_materials[m.geometry])),p instanceof THREE.MeshFaceMaterial)for(var w=0;w<p.materials.length;w++)v=v||p.materials[w]instanceof THREE.ShaderMaterial;v&&o.computeTangents(),m.skin?l=new THREE.SkinnedMesh(o,p):m.morph?(l=new THREE.MorphAnimMesh(o,p),void 0!==m.duration&&(l.duration=m.duration),void 0!==m.time&&(l.time=m.time),void 0!==m.mirroredLoop&&(l.mirroredLoop=m.mirroredLoop),p.morphNormals&&o.computeMorphNormals()):l=new THREE.Mesh(o,p),l.name=k,c?(l.matrixAutoUpdate=!1,l.matrix.set(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15])):(l.position.fromArray(e),i?l.quaternion.fromArray(i):l.rotation.fromArray(g),l.scale.fromArray(h)),l.visible=m.visible,l.castShadow=m.castShadow,l.receiveShadow=m.receiveShadow,a.add(l),z.objects[k]=l}}else if("AmbientLight"===m.type||"PointLight"===m.type||"DirectionalLight"===m.type||"SpotLight"===m.type||"HemisphereLight"===m.type||"AreaLight"===m.type){var x=m.color,y=m.intensity,B=m.distance,C=m.position,E=m.rotation;switch(m.type){case"AmbientLight":u=new THREE.AmbientLight(x);break;case"PointLight":u=new THREE.PointLight(x,y,B),u.position.fromArray(C);break;case"DirectionalLight":u=new THREE.DirectionalLight(x,y),u.position.fromArray(m.direction);break;case"SpotLight":u=new THREE.SpotLight(x,y,B,1),u.angle=m.angle,u.position.fromArray(C),u.target.set(C[0],C[1]-B,C[2]),u.target.applyEuler(new THREE.Euler(E[0],E[1],E[2],"XYZ"));break;case"HemisphereLight":u=new THREE.DirectionalLight(x,y,B),u.target.set(C[0],C[1]-B,C[2]),u.target.applyEuler(new THREE.Euler(E[0],E[1],E[2],"XYZ"));break;case"AreaLight":u=new THREE.AreaLight(x,y),u.position.fromArray(C),u.width=m.size,u.height=m.size_y}a.add(u),u.name=k,z.lights[k]=u,z.objects[k]=u}else"PerspectiveCamera"===m.type||"OrthographicCamera"===m.type?(e=m.position,g=m.rotation,i=m.quaternion,"PerspectiveCamera"===m.type?q=new THREE.PerspectiveCamera(m.fov,m.aspect,m.near,m.far):"OrthographicCamera"===m.type&&(q=new THREE.OrthographicCamera(m.left,m.right,m.top,m.bottom,m.near,m.far)),q.name=k,q.position.fromArray(e),void 0!==i?q.quaternion.fromArray(i):void 0!==g&&q.rotation.fromArray(g),a.add(q),z.cameras[k]=q,z.objects[k]=q):(e=m.position,g=m.rotation,h=m.scale,i=m.quaternion,l=new THREE.Object3D,l.name=k,l.position.fromArray(e),i?l.quaternion.fromArray(i):l.rotation.fromArray(g),l.scale.fromArray(h),l.visible=void 0!==m.visible?m.visible:!1,a.add(l),z.objects[k]=l,z.empties[k]=l);if(l){if(void 0!==m.userData)for(var F in m.userData){var G=m.userData[F];l.userData[F]=G}if(void 0!==m.groups)for(var w=0;w<m.groups.length;w++){var H=m.groups[w];void 0===z.groups[H]&&(z.groups[H]=[]),z.groups[H].push(k)}}}void 0!==l&&void 0!==m.children&&f(l,m.children)}}function g(a,b,c){z.geometries[c]=a,z.face_materials[c]=b,e()}function h(a,b,c,d,f){var g=f.position,h=f.rotation,i=f.quaternion,j=f.scale;a.position.fromArray(g),i?a.quaternion.fromArray(i):a.rotation.fromArray(h),a.scale.fromArray(j),d&&a.traverse(function(a){a.material=d});var k=void 0!==f.visible?f.visible:!0;a.traverse(function(a){a.visible=k}),c.add(a),a.name=b,z.objects[b]=a,e()}function i(a){return function(b,c){b.name=a,g(b,c,a),v-=1,A.onLoadComplete(),l()}}function j(a,b,c,d){return function(e){var f;f=e.content?e.content:e.dae?e.scene:e,h(f,a,b,c,d),v-=1,A.onLoadComplete(),l()}}function k(a){return function(b,c){b.name=a,z.geometries[a]=b,z.face_materials[a]=c}}function l(){var a={totalModels:x,totalTextures:y,loadedModels:x-v,loadedTextures:y-w};A.callbackProgress(a,z),A.onLoadProgress(),0===v&&0===w&&(m(),b(z))}function m(){for(var a=0;a<C.length;a++){var b=C[a],c=z.objects[b.targetName];c?b.object.target=c:(b.object.target=new THREE.Object3D,z.scene.add(b.object.target)),b.object.target.userData.targetInverse=b.object}}function n(a,b){if(b(a),void 0!==a.children)for(var c in a.children)n(a.children[c],b)}var o,p,q,r,s,t,u,v,w,x,y,z,A=this,B=THREE.Loader.prototype.extractUrlBase(c),C=[],D=a;for(var E in this.geometryHandlers){var F=this.geometryHandlers[E].loaderClass;this.geometryHandlers[E].loaderObject=new F}for(var E in this.hierarchyHandlers){var F=this.hierarchyHandlers[E].loaderClass;this.hierarchyHandlers[E].loaderObject=new F}if(v=0,w=0,z={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},D.transform){var G=D.transform.position,H=D.transform.rotation,I=D.transform.scale;G&&z.scene.position.fromArray(G),H&&z.scene.rotation.fromArray(H),I&&z.scene.scale.fromArray(I),(G||H||I)&&(z.scene.updateMatrix(),z.scene.updateMatrixWorld())}var J,K,L=function(a){w-=a,l(),A.onLoadComplete()},M=function(a){return function(){L(a)}};for(J in D.fogs)K=D.fogs[J],"linear"===K.type?r=new THREE.Fog(0,K.near,K.far):"exp2"===K.type&&(r=new THREE.FogExp2(0,K.density)),t=K.color,r.color.setRGB(t[0],t[1],t[2]),z.fogs[J]=r;var N,O;for(N in D.geometries)O=D.geometries[N],O.type in this.geometryHandlers&&(v+=1,A.onLoadStart());for(var P in D.objects)n(D.objects[P],function(a){a.type&&a.type in A.hierarchyHandlers&&(v+=1,A.onLoadStart())});x=v;for(N in D.geometries)if(O=D.geometries[N],"cube"===O.type)o=new THREE.BoxGeometry(O.width,O.height,O.depth,O.widthSegments,O.heightSegments,O.depthSegments),o.name=N,z.geometries[N]=o;else if("plane"===O.type)o=new THREE.PlaneGeometry(O.width,O.height,O.widthSegments,O.heightSegments),o.name=N,z.geometries[N]=o;else if("sphere"===O.type)o=new THREE.SphereGeometry(O.radius,O.widthSegments,O.heightSegments),o.name=N,z.geometries[N]=o;else if("cylinder"===O.type)o=new THREE.CylinderGeometry(O.topRad,O.botRad,O.height,O.radSegs,O.heightSegs),o.name=N,z.geometries[N]=o;else if("torus"===O.type)o=new THREE.TorusGeometry(O.radius,O.tube,O.segmentsR,O.segmentsT),o.name=N,z.geometries[N]=o;else if("icosahedron"===O.type)o=new THREE.IcosahedronGeometry(O.radius,O.subdivisions),o.name=N,z.geometries[N]=o;else if(O.type in this.geometryHandlers){var Q={};for(var R in O)"type"!==R&&"url"!==R&&(Q[R]=O[R]);var S=this.geometryHandlers[O.type].loaderObject;S.load(d(O.url,D.urlBaseType),i(N),Q)}else if("embedded"===O.type){var T=D.embeds[O.id],U="";if(T.metadata=D.metadata,T){var V=this.geometryHandlers.ascii.loaderObject,W=V.parse(T,U);k(N)(W.geometry,W.materials)}}var X,Y;for(X in D.textures)if(Y=D.textures[X],Y.url instanceof Array){w+=Y.url.length;for(var Z=0;Z<Y.url.length;Z++)A.onLoadStart()}else w+=1,A.onLoadStart();y=w;for(X in D.textures){Y=D.textures[X],void 0!==Y.mapping&&void 0!==THREE[Y.mapping]&&(Y.mapping=new THREE[Y.mapping]);var s;if(Y.url instanceof Array){for(var $=Y.url.length,_=[],ab=0;$>ab;ab++)_[ab]=d(Y.url[ab],D.urlBaseType);var S=THREE.Loader.Handlers.get(_[0]);null!==S?(s=S.load(_,M($)),s.mapping=Y.mapping):s=THREE.ImageUtils.loadTextureCube(_,Y.mapping,M($))}else{var bb=d(Y.url,D.urlBaseType),cb=M(1),S=THREE.Loader.Handlers.get(bb);if(null!==S?s=S.load(bb,cb):(s=new THREE.Texture,S=new THREE.ImageLoader,function(a){S.load(bb,function(b){a.image=b,a.needsUpdate=!0,cb()})}(s)),s.mapping=Y.mapping,void 0!==THREE[Y.minFilter]&&(s.minFilter=THREE[Y.minFilter]),void 0!==THREE[Y.magFilter]&&(s.magFilter=THREE[Y.magFilter]),Y.anisotropy&&(s.anisotropy=Y.anisotropy),Y.repeat&&(s.repeat.set(Y.repeat[0],Y.repeat[1]),1!==Y.repeat[0]&&(s.wrapS=THREE.RepeatWrapping),1!==Y.repeat[1]&&(s.wrapT=THREE.RepeatWrapping)),Y.offset&&s.offset.set(Y.offset[0],Y.offset[1]),Y.wrap){var db={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==db[Y.wrap[0]]&&(s.wrapS=db[Y.wrap[0]]),void 0!==db[Y.wrap[1]]&&(s.wrapT=db[Y.wrap[1]])}}z.textures[X]=s}var eb,fb,gb;for(eb in D.materials){fb=D.materials[eb];for(gb in fb.parameters)if("envMap"===gb||"map"===gb||"lightMap"===gb||"bumpMap"===gb)fb.parameters[gb]=z.textures[fb.parameters[gb]];else if("shading"===gb)fb.parameters[gb]="flat"===fb.parameters[gb]?THREE.FlatShading:THREE.SmoothShading;else if("side"===gb)fb.parameters[gb]="double"==fb.parameters[gb]?THREE.DoubleSide:"back"==fb.parameters[gb]?THREE.BackSide:THREE.FrontSide;else if("blending"===gb)fb.parameters[gb]=fb.parameters[gb]in THREE?THREE[fb.parameters[gb]]:THREE.NormalBlending;else if("combine"===gb)fb.parameters[gb]=fb.parameters[gb]in THREE?THREE[fb.parameters[gb]]:THREE.MultiplyOperation;else if("vertexColors"===gb)"face"==fb.parameters[gb]?fb.parameters[gb]=THREE.FaceColors:fb.parameters[gb]&&(fb.parameters[gb]=THREE.VertexColors);else if("wrapRGB"===gb){var hb=fb.parameters[gb];fb.parameters[gb]=new THREE.Vector3(hb[0],hb[1],hb[2])}if(void 0!==fb.parameters.opacity&&fb.parameters.opacity<1&&(fb.parameters.transparent=!0),fb.parameters.normalMap){var ib=THREE.ShaderLib.normalmap,jb=THREE.UniformsUtils.clone(ib.uniforms),kb=fb.parameters.color,lb=fb.parameters.specular,mb=fb.parameters.ambient,nb=fb.parameters.shininess;jb.tNormal.value=z.textures[fb.parameters.normalMap],fb.parameters.normalScale&&jb.uNormalScale.value.set(fb.parameters.normalScale[0],fb.parameters.normalScale[1]),fb.parameters.map&&(jb.tDiffuse.value=fb.parameters.map,jb.enableDiffuse.value=!0),fb.parameters.envMap&&(jb.tCube.value=fb.parameters.envMap,jb.enableReflection.value=!0,jb.reflectivity.value=fb.parameters.reflectivity),fb.parameters.lightMap&&(jb.tAO.value=fb.parameters.lightMap,jb.enableAO.value=!0),fb.parameters.specularMap&&(jb.tSpecular.value=z.textures[fb.parameters.specularMap],jb.enableSpecular.value=!0),fb.parameters.displacementMap&&(jb.tDisplacement.value=z.textures[fb.parameters.displacementMap],jb.enableDisplacement.value=!0,jb.uDisplacementBias.value=fb.parameters.displacementBias,jb.uDisplacementScale.value=fb.parameters.displacementScale),jb.diffuse.value.setHex(kb),jb.specular.value.setHex(lb),jb.ambient.value.setHex(mb),jb.shininess.value=nb,fb.parameters.opacity&&(jb.opacity.value=fb.parameters.opacity);var ob={fragmentShader:ib.fragmentShader,vertexShader:ib.vertexShader,uniforms:jb,lights:!0,fog:!0};p=new THREE.ShaderMaterial(ob)}else p=new THREE[fb.type](fb.parameters);p.name=eb,z.materials[eb]=p}for(eb in D.materials)if(fb=D.materials[eb],fb.parameters.materials){for(var pb=[],ab=0;ab<fb.parameters.materials.length;ab++){var qb=fb.parameters.materials[ab];pb.push(z.materials[qb])}z.materials[eb].materials=pb}e(),z.cameras&&D.defaults.camera&&(z.currentCamera=z.cameras[D.defaults.camera]),z.fogs&&D.defaults.fog&&(z.scene.fog=z.fogs[D.defaults.fog]),A.callbackSync(z),l()}};var BakedSceneObject,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};BakedSceneObject=function(a){function b(a,c){this.textured=null!=c?c:!0,this.onLoad=__bind(this.onLoad,this),b.__super__.constructor.call(this),this.onLoadSignal=new signals.Signal,this.name=a,(new THREE.JSONLoader).load("models/"+a+".js",this.onLoad)}return __extends(b,a),b.prototype.onLoad=function(a,b){var c;c=b[0],this.textured&&(c.map=THREE.ImageUtils.loadTexture("models/textures/"+c.name+".jpg")),c.emissive.set(16777215),this.mesh=new THREE.Mesh(a,c),this.add(this.mesh),this.onLoadSignal.dispatch(this)},b}(THREE.Object3D);var Bullet,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Bullet=function(a){function b(a){this.reset=__bind(this.reset,this),this.explode=__bind(this.explode,this);var c,d,e,f,g,h;for(b.__super__.constructor.call(this),c=new THREE.IcosahedronGeometry(2,2),h=c.vertices,f=0,g=h.length;g>f;f++)e=h[f],e.x+=1*Math.random()-.5,e.y+=1*Math.random()-.5,e.z+=1*Math.random()-.5;c.computeFaceNormals(),c.computeVertexNormals(),d=new THREE.MeshBasicMaterial({transparent:!0,refractionRatio:.98,color:16777215,envMap:a}),this.mesh=new THREE.Mesh(c,d),this.add(this.mesh)}return __extends(b,a),b.prototype.explode=function(){this.mesh.scale.set(1e-4,1e-4,1e-4),this.mesh.material.opacity=0},b.prototype.reset=function(){this.mesh.material.opacity=1,this.mesh.scale.set(1,1,1)},b}(THREE.Object3D);var Enemy,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Enemy=function(a){function b(a){this.onComplete=__bind(this.onComplete,this),this.explode=__bind(this.explode,this),this.updateShield=__bind(this.updateShield,this),this.hit=__bind(this.hit,this),this.reset=__bind(this.reset,this),this.killTweens=__bind(this.killTweens,this);var c,d,e,f;for(b.__super__.constructor.call(this),this.explodable=!0,this.onExplode=new signals.Signal,this.onExploded=new signals.Signal,this.mesh=this.shield=new THREE.Mesh(new THREE.IcosahedronGeometry(1.2*this.size,2),new THREE.MeshBasicMaterial({transparent:!0,wireframe:!0})),null!=a&&(this.shield.material.envMap=a),f=this.shield.geometry.vertices,d=0,e=f.length;e>d;d++)c=f[d],c.x+=2*Math.random()-1,c.y+=2*Math.random()-1,c.z+=2*Math.random()-1;this.shield.geometry.computeFaceNormals(),this.shield.geometry.computeVertexNormals(),this.add(this.shield),this.add(this.mesh),this.reset()}var c;return __extends(b,a),c=10,b.prototype.size=1,b.prototype.speed=1,b.prototype.health=1,b.prototype.killTweens=function(){TweenLite.killTweensOf(this.position),TweenLite.killTweensOf(this.scale),TweenLite.killTweensOf(this.mesh.material)},b.prototype.reset=function(){this.killTweens(),this.currentHealth=this.health,this.mesh.material.opacity=1,this.isAlive=!0,this.scale.set(1,1,1),this.updateShield(),this.visible=!0},b.prototype.hit=function(){return this.isAlive?(this.currentHealth-=1,this.updateShield(),this.currentHealth<=0?this.explode():void 0):void 0},b.prototype.updateShield=function(){this.shield.material.opacity=(this.currentHealth-1)/this.health/c,this.shield.visible=this.shield.material.opacity>0},b.prototype.explode=function(){var a;this.isAlive&&this.explodable&&(this.isAlive=!1,a=.2,this.onExplode.dispatch(this),TweenLite.to(this.mesh.material,a,{opacity:0}),TweenLite.to(this.scale,.05,{x:1e-4,y:1e-4,z:1e-4,delay:a,onComplete:this.onComplete}))},b.prototype.onComplete=function(){this.killTweens(),this.visible=!1,this.onExploded.dispatch(this)},b}(THREE.Object3D);var BigEnemy,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};BigEnemy=function(a){function b(){this.updateShield=__bind(this.updateShield,this),this.build=__bind(this.build,this),b.__super__.constructor.call(this),b.geometry?this.build():b.onModelLoad.add(this.build)}return __extends(b,a),b.prototype.size=100,b.prototype.speed=.2,b.prototype.health=1e3,b.prototype.build=function(){this.mesh=new THREE.Mesh(b.geometry,b.material.clone()),this.add(this.mesh),this.shield.visible=!1},b.prototype.updateShield=function(){},b}(Enemy),BigEnemy.onModelLoad=new signals.Signal,BigEnemy.loader=new THREE.JSONLoader,BigEnemy.loader.load("models/boss.js",function(a,b){return BigEnemy.geometry=a,BigEnemy.material=b[0],BigEnemy.material.shininess=5,BigEnemy.material.emissive.set(16777215),BigEnemy.material.map=THREE.ImageUtils.loadTexture("models/textures/boss.jpg"),BigEnemy.onModelLoad.dispatch()});var SmallEnemy,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};SmallEnemy=function(a){function b(a){this.build=__bind(this.build,this),b.__super__.constructor.call(this,a),b.geometry?this.build():b.onModelLoad.add(this.build)}return __extends(b,a),b.prototype.size=4,b.prototype.speed=1,b.prototype.health=1,b.prototype.build=function(){this.reset(),this.mesh=new THREE.Mesh(b.geometry,b.material.clone()),this.add(this.mesh)},b}(Enemy),SmallEnemy.onModelLoad=new signals.Signal,SmallEnemy.loader=new THREE.JSONLoader,SmallEnemy.loader.load("models/enemy.js",function(a,b){return SmallEnemy.geometry=a,SmallEnemy.material=b[0],SmallEnemy.material.shininess=10,SmallEnemy.material.transparent=!0,SmallEnemy.material.emissive.set(16777215),SmallEnemy.material.map=THREE.ImageUtils.loadTexture("models/textures/enemy.jpg"),SmallEnemy.onModelLoad.dispatch()});var Ray,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Ray=function(a){function b(){this.update=__bind(this.update,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this);var a,c;b.__super__.constructor.call(this),c=new THREE.SpriteMaterial({map:THREE.ImageUtils.loadTexture("images/crosshair.png"),depthTest:!1,depthWrite:!1}),a=new THREE.Sprite(c),a.scale.set(80,80,1),a.position.z=1e3,a.renderDepth=1e20,this.add(a)}return __extends(b,a),b.prototype.show=function(){},b.prototype.hide=function(){},b.prototype.update=function(){},b}(THREE.Object3D);var Explosion,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Explosion=function(a){function b(){this.onComplete=__bind(this.onComplete,this),this.explode=__bind(this.explode,this),this.getSize=__bind(this.getSize,this),this.setSize=__bind(this.setSize,this),b.__super__.constructor.call(this),this.onExplode=new signals.Signal,this.texture=THREE.ImageUtils.loadTexture("images/explosion.png"),this.material=new THREE.SpriteMaterial({map:this.texture,blending:THREE.AdditiveBlending,rotation:Math.random()*Math.PI*2,color:16724787}),this.texture.wrapS=THREE.RepeatWrapping,this.texture.wrapT=THREE.RepeatWrapping,this.texture.repeat.y=e,this.sprite=new THREE.Sprite(this.material),this.setSize(256),this.add(this.sprite)
}var c,d,e;return __extends(b,a),d=22,e=1/d,c=null,b.prototype.setSize=function(a){this.sprite.scale.set(a,a,1)},b.prototype.getSize=function(){return this.sprite.scale.x},b.prototype.explode=function(a){null==a&&(a=20),this.setSize(a),TweenLite.fromTo(this.texture.offset,.6+.4*Math.random(),{y:0},{y:e*d,ease:SteppedEase.config(d)},this.onComplete),TweenLite.delayedCall(.1,function(a){return function(){a.onExplode.dispatch(a)}}(this))},b.prototype.onComplete=function(){this.texture.offset.y=0},b}(THREE.Object3D);var World,__bind=function(a,b){return function(){return a.apply(b,arguments)}};World=function(){function a(){this.update=__bind(this.update,this),this.resize=__bind(this.resize,this),this.throwEnemies=__bind(this.throwEnemies,this),this.resetBigEnemies=__bind(this.resetBigEnemies,this),this.shoot=__bind(this.shoot,this),this.onEnemyTweenComplete=__bind(this.onEnemyTweenComplete,this),this.onEnemyExploded=__bind(this.onEnemyExploded,this),this.onEnemyExplode=__bind(this.onEnemyExplode,this),this.onExplosionExplode=__bind(this.onExplosionExplode,this),this.explosionAt=__bind(this.explosionAt,this),this.createEnemy=__bind(this.createEnemy,this),this.buildScene=__bind(this.buildScene,this),this.reset=__bind(this.reset,this),this.build=__bind(this.build,this),this.build()}var b,c;return c=150,b=1,a.prototype.build=function(){return this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e5),this.renderer=new THREE.WebGLRenderer({antialias:!1}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(16772829),document.body.appendChild(this.renderer.domElement),this.camera.position.set(-40,20,-560),this.scene.fog=new THREE.Fog(16772829,1e3,2e3),this.cubeCamera=new THREE.CubeCamera(1,1e3,256),this.cubeCamera.renderTarget.minFilter=THREE.LinearMipMapLinearFilter,this.cubeCamera.position.set(0,20,-300),this.scene.add(this.cubeCamera),this.vrActivated=!1,this.time=0,this.level=1,this.lifes=b,this.buildScene(),this.effect=new THREE.VREffect(this.renderer,function(a){return function(b){return b?(a.controls=new THREE.TrackballControls(a.camera),a.ray.visible=!1,document.body.onclick=function(){a.reset(),a.ray.visible=!0,document.getElementById("launch-button").classList.add("hide"),a.camera.position.set(0,10,0),document.body.requestPointerLock=document.body.requestPointerLock||document.body.mozRequestPointerLock||document.body.webkitRequestPointerLock,document.body.requestPointerLock(),a.controls=new THREE.PointerLockControls(a.camera),a.controls.enabled=!0,a.scene.add(a.controls.getObject())}):(a.controls=new THREE.VRControls(a.camera),a.vrActivated=!0,document.body.onclick=function(){a.camera.position.set(0,20,0),document.getElementById("launch-button").classList.add("hide"),a.effect.startFullscreen(),a.reset()}),a.update()}}(this))},a.prototype.reset=function(){var a,c,d,e;for(this.level=1,this.time=0,this.lifes=b,e=this.enemies,c=0,d=e.length;d>c;c++)a=e[c],a.explode();this.emitters=[new THREE.Vector3(0,25,-350)],this.resetBigEnemies()},a.prototype.buildScene=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n;for(f=new THREE.DirectionalLight(16777215,.5),f.position.set(-250,1646,121),this.scene.add(f),this.scene.add(new Ground),n=["monument","sun","inside-light","crashed-enemy1","crashed-enemy2"],h=0,l=n.length;l>h;h++)g=n[h],this.scene.add(new BakedSceneObject(g,-1===["sun","inside-light"].indexOf(g)));for(this.scene.getObjectByName("sun").onLoadSignal.add(function(a){a.mesh.material.fog=!1}),this.ray=new Ray,this.scene.add(this.ray),this.collidableMeshes=[],this.enemies=[],e=i=0;c>=0?c>i:i>c;e=c>=0?++i:--i)this.enemies.push(this.createEnemy("small"));for(this.bigEnemies=[],e=j=0;5>j;e=++j)a=this.createEnemy("big"),a.position.y=-5e3,this.bigEnemies.push(a);for(this.bullets=[],e=k=0;40>k;e=++k)b=new Bullet(this.cubeCamera.renderTarget),this.scene.add(b),this.bullets.push(b);for(this.explosions=[],e=m=0;100>m;e=++m)d=new Explosion,this.scene.add(d),d.position.y=-100,d.onExplode.add(this.onExplosionExplode),this.explosions.push(d);this.direction=new THREE.Vector3,this.raycaster=new THREE.Raycaster,this.raycaster.far=2e3},a.prototype.createEnemy=function(a){var b;switch(a){case"small":b=new SmallEnemy(this.cubeCamera.renderTarget);break;case"big":b=new BigEnemy}return this.collidableMeshes.push(b.shield),b.shield.visible=!0,b.onExplode.add(this.onEnemyExplode),b.onExploded.add(this.onEnemyExploded),this.scene.add(b),b},a.prototype.explosionAt=function(a,b){var c;null==b&&(b=1),c=this.explosions[0],c.position.copy(a),c.explode(b),this.explosions.push(this.explosions.shift())},a.prototype.onExplosionExplode=function(a){var b,c,d,e;for(e=this.enemies,c=0,d=e.length;d>c;c++)b=e[c],b.position.distanceTo(a.position)<.25*a.getSize()&&b.hit()},a.prototype.onEnemyExplode=function(a){this.explosionAt(a.position,10*a.size)},a.prototype.onEnemyExploded=function(a){var b,c,d,e;if(a instanceof BigEnemy)for(e=this.emitters,c=0,d=e.length;d>c;c++)b=e[c],b.z===a.position.z+100&&this.emitters.splice(this.emitters.indexOf(b),1)},a.prototype.onEnemyTweenComplete=function(a){var c,d,e,f;if(a instanceof BigEnemy){if(!a.isAlive)return;this.emitters.push(new THREE.Vector3(a.position.x,a.position.y,a.position.z+100))}else if(a instanceof SmallEnemy&&(a.explode(),this.lifes--,this.lifes<=0)){for(f=this.enemies,d=0,e=f.length;e>d;d++)c=f[d],c.explode();this.lifes=b}},a.prototype.shoot=function(a){var b;b=this.bullets[0],b.position.set(10*Math.random()-5,12,0),b.reset(this.renderer,this.scene),b.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),TweenLite.to(b.position,.2,{x:a.x,y:a.y,z:a.z,onComplete:b.explode,ease:Linear.easeOut}),this.bullets.push(this.bullets.shift())},a.prototype.resetBigEnemies=function(){var a,b,c,d,e;for(e=this.bigEnemies,b=c=0,d=e.length;d>c;b=++c)a=e[b],TweenLite.killTweensOf(a.position),a.position.set(1500*Math.random()-750,200*Math.random()+100,-3e3),TweenLite.to(a.position,30*(b+1)+10,{z:-400-80*b,ease:Linear.easeOut,onComplete:this.onEnemyTweenComplete,onCompleteParams:[a]})},a.prototype.throwEnemies=function(a,b,d){var e,f,g,h,i;for(null==d&&(d=1),e=[{x:200*Math.random()-100,y:10+100*Math.random(),z:-300},{x:200*Math.random()-100,y:10+100*Math.random(),z:-200},{x:200*Math.random()-100,y:10+100*Math.random(),z:-100},{x:0,y:16,z:0}],h=0,f=0,i=this.emitters[Math.floor(Math.random()*this.emitters.length)],i!==this.emitters[0]&&(b*=1.5);a>h;){if(g=this.enemies[h++],null==g){if(this.enemies.length>=c)break;g=this.createEnemy("small")}else if(g.isAlive){a++;continue}g.reset(),g.health=d,g.position.copy(i),g.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),f+=.1,g.mesh.material.opacity=0,TweenLite.to(g.mesh.material,1,{opacity:1,delay:f}),TweenMax.to(g.position,b,{bezier:{values:e},delay:f,ease:Linear.easeOut,onComplete:this.onEnemyTweenComplete,onCompleteParams:[g]})}},a.prototype.resize=function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},a.prototype.update=function(){var a,b,c,d,e,f;return requestAnimationFrame(this.update),this.time++,this.level=1+Math.floor(this.time/100),this.time%100===0&&(this.renderer.enableScissorTest(!1),this.cubeCamera.updateCubeMap(this.renderer,this.scene)),f=20+Math.floor((this.level>80?80:this.level)*Math.random()),this.time%f===0&&(b=50-Math.floor(Math.random()*(this.level>50?50:this.level)),d=1,25>b&&Math.random()<.2&&(d=7),a=10+d,console.log("///////////////////"),console.log("@level ",this.level),console.log("health ",d),console.log("duration ",a),console.log("timeStep ",f),console.log("enemiesCount ",b),this.throwEnemies(b,a,d)),this.controls.update(),this.direction.set(0,0,-1),this.direction.applyQuaternion(this.camera.quaternion),this.ray.position.copy(this.camera.position),this.controls instanceof THREE.PointerLockControls&&(this.controls.getDirection(this.direction),this.ray.position.copy(this.controls.getObject().position),this.ray.position.y+=10),this.raycaster.set(this.ray.position,this.direction),e=this.raycaster.intersectObjects(this.collidableMeshes)[0],this.direction.add(this.ray.position),this.ray.lookAt(this.direction),this.direction.sub(this.ray.position),e&&e.object.parent instanceof Enemy&&(c=e.object.parent,this.shoot(e.point),c.isAlive&&(c.hit(),this.explosionAt(e.point,e.object.parent.size))),this.effect?this.effect.render(this.scene,this.camera):this.renderer.render(this.scene,this.camera)},a}();var Ground,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Ground=function(a){function b(){this.onLoad=__bind(this.onLoad,this),b.__super__.constructor.call(this,"ground")}return __extends(b,a),b.prototype.onLoad=function(a,c){b.__super__.onLoad.call(this,a,c),c[0].shininess=10},b}(BakedSceneObject);var world;world=new World,window.addEventListener("resize",function(){world.resize()});